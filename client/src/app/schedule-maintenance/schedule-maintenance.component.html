
<div class="d-flex justify-content-between align-items-center mt-4 page-header">
  <h2 class="mb-0 page-title">Schedule Maintenance</h2>
</div>

<!-- Schedule Form Card -->
<div class="container mt-4">
  <div class="card soft-card fade-in">
    <div class="card-header text-center fw-bold">Schedule Maintenance of Equipment</div>

    <div class="card-body">
      <!-- Alerts -->
      <div *ngIf="showError" class="alert alert-danger" role="alert" aria-live="assertive">
        {{ errorMessage }}
      </div>
      <div *ngIf="showMessage" class="alert alert-success" role="alert" aria-live="polite">
        {{ responseMessage }}
      </div>

      <form class="mb-3 mt-md-2" [formGroup]="itemForm" (ngSubmit)="onSubmit()" novalidate>
        <div class="row gy-3">
          <!-- Left Column -->
          <div class="col-md-6">
            <div class="mb-3">
              <label for="hospitalId" class="form-label fw-semibold">Hospital</label>
              <select
                id="hospitalId"
                class="form-control"
                formControlName="hospitalId"
                (change)="onHospitalSelect($event)"
                aria-label="Select Hospital"
              >
                <option value="">Please Choose</option>
                <option *ngFor="let hos of hospitalList" [value]="hos.id">{{ hos.name }}</option>
              </select>
              <div
                *ngIf="itemForm.controls['hospitalId'].invalid && (itemForm.controls['hospitalId'].dirty || itemForm.controls['hospitalId'].touched)"
                class="text-danger mt-1"
              >
                Please choose hospital.
              </div>
            </div>

            <div class="mb-3">
              <label for="equipmentId" class="form-label fw-semibold">Equipment</label>
              <select
                id="equipmentId"
                class="form-control"
                formControlName="equipmentId"
                aria-label="Select Equipment"
              >
                <option value="">Please Choose</option>
                <option *ngFor="let eq of equipmentList" [value]="eq.id">{{ eq.name }}</option>
              </select>
              <div
                *ngIf="itemForm.controls['equipmentId'].invalid && (itemForm.controls['equipmentId'].dirty || itemForm.controls['equipmentId'].touched)"
                class="text-danger mt-1"
              >
                Please choose Equipment.
              </div>
            </div>
          </div>

          <!-- Right Column -->
          <div class="col-md-6">
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="scheduledDate" class="form-label fw-semibold">Scheduled Date</label>
                  <input
                    type="date"
                    id="scheduledDate"
                    class="form-control"
                    formControlName="scheduledDate"
                    placeholder="Scheduled Date"
                  />
                  <div
                    *ngIf="itemForm.controls['scheduledDate'].invalid && (itemForm.controls['scheduledDate'].dirty || itemForm.controls['scheduledDate'].touched)"
                    class="text-danger mt-1"
                  >
                    Please enter a valid future Scheduled Date.
                  </div>
                </div>
              </div>

              <div class="col-md-6">
                <div class="mb-3">
                  <label for="completedDate" class="form-label fw-semibold">Deadline</label>
                  <input
                    type="date"
                    id="completedDate"
                    class="form-control"
                    formControlName="completedDate"
                    placeholder="Completed Date"
                  />
                  <div
                    *ngIf="itemForm.controls['completedDate'].invalid && (itemForm.controls['completedDate'].dirty || itemForm.controls['completedDate'].touched)"
                    class="text-danger mt-1"
                  >
                    Please enter a valid future Deadline.
                  </div>
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label for="description" class="form-label fw-semibold">Description</label>
              <input
                type="text"
                id="description"
                class="form-control"
                formControlName="description"
                placeholder="Description"
              />
              <div
                *ngIf="itemForm.controls['description'].invalid && (itemForm.controls['description'].dirty || itemForm.controls['description'].touched)"
                class="text-danger mt-1"
              >
                Please enter Description.
              </div>
            </div>

            <div class="mb-3">
              <label for="status" class="form-label fw-semibold">Status</label>
              <select id="status" class="form-control" formControlName="status" aria-label="Select Status">
                <option value="">Choose Status</option>
                <option value="Initiated">Initiated</option>
              </select>
              <div
                *ngIf="itemForm.controls['status'].invalid && (itemForm.controls['status'].dirty || itemForm.controls['status'].touched)"
                class="text-danger mt-1"
              >
                Please choose status.
              </div>
            </div>

            <!-- Actions -->
            <div class="d-flex gap-2 mt-2">
              <button class="btn btn-gradient" type="submit" [disabled]="itemForm.invalid">
                <span class="btn-icon">üóìÔ∏è</span> Submit
              </button>
              <button class="btn btn-ghost" type="button" (click)="showSatus()">
                <span class="btn-icon">üìã</span> {{ isClick ? 'Hide' : 'Show' }} Status
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Manage Maintenance (Cards) -->
<div class="container mt-4" *ngIf="isClick">
  <div class="card soft-card fade-in">
    <div class="card-header fw-bold">Maintenance Information</div>
    <div class="card-body">
      <div class="sched-grid">
        <article
          class="sched-card fade-in-up"
          *ngFor="let m of maintenanceList; let i = index; trackBy: trackByMaintId"
          [ngClass]="[
            cardToneClass(i),
            isServiced(m.status) ? 'is-serviced' : '',
            isShaking(m.id) ? 'is-shaking' : ''
          ]"
          (click)="shakeCard(m.id)"
          (touchstart)="shakeCard(m.id)"
          (animationend)="onAnimationEnd(m.id, $event)"
          tabindex="0"
          aria-label="Schedule maintenance card"
        >
          <div class="card-accent"></div>

          <!-- Pretty, compact corner ribbon for serviced -->
          <div class="corner-ribbon" *ngIf="isServiced(m.status)" aria-hidden="true">
            <span class="ribbon-chip">
              <span class="ribbon-icon">‚úî</span>
              Serviced
            </span>
          </div>

          <div class="sched-card-header d-flex align-items-center justify-content-between">
            <div class="sched-id">#{{ m.id }}</div>
            <span class="status-chip" [ngClass]="statusClass(m.status)">{{ m.status }}</span>
          </div>

          <div class="sched-meta">
            <div class="meta-item">
              <span class="meta-label">Scheduled</span>
              <span class="meta-value">{{ m.scheduledDate | date:'dd-MMM-yyyy' }}</span>
            </div>
            <div class="meta-item">
              <span class="meta-label">Deadline</span>
              <span class="meta-value">{{ m.completedDate | date:'dd-MMM-yyyy' }}</span>
            </div>
          </div>

          <div class="info-block">
            <div class="info-title">
              <span class="dot dot-eq"></span> Equipment
            </div>
            <div class="info-content">
              <div class="info-row"><span class="key">Id:</span> <span class="val">{{ m.equipment?.id }}</span></div>
              <div class="info-row"><span class="key">Name:</span> <span class="val">{{ m.equipment?.name }}</span></div>
              <div class="info-row"><span class="key">Description:</span> <span class="val">{{ m.equipment?.description }}</span></div>
            </div>
          </div>

          <div class="info-block">
            <div class="info-title">
              <span class="dot dot-hosp"></span> Hospital
            </div>
            <div class="info-content">
              <div class="info-row"><span class="key">Id:</span> <span class="val">{{ m.equipment?.hospital?.id }}</span></div>
              <div class="info-row"><span class="key">Name:</span> <span class="val">{{ m.equipment?.hospital?.name }}</span></div>
              <div class="info-row"><span class="key">Location:</span> <span class="val">{{ m.equipment?.hospital?.location }}</span></div>
            </div>
          </div>

          
        </article>

        <!-- Empty state -->
        <div class="empty-state" *ngIf="!maintenanceList || maintenanceList.length === 0">
          <div class="empty-illustration">üóÇÔ∏è</div>
          <p class="empty-text">No scheduled maintenance to show.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<section class="login-page mt-10">
  <div class="container">
    <div class="login-card row g-0">

      <!-- LEFT SIDE : REGISTRATION FORM -->
      <div class="col-lg-6 col-md-12 login-left">
        <div class="login-form">

          <div class="login-header">
            <span class="icon">ü©∫</span>
            <h3>Register</h3>
          </div>

          <form [formGroup]="itemForm" (ngSubmit)="onRegister()">

            <!-- Username -->
            <div class="form-group mb-3">
              <label>Username</label>
              <input
                type="text"
                class="form-control"
                formControlName="username"
                placeholder="Enter username"
              />
              <small class="text-danger"
                *ngIf="itemForm.get('username')?.touched && itemForm.get('username')?.invalid">
                Username is required
              </small>
            </div>

            <!-- Email -->
            <div class="form-group mb-3">
              <label>Email address</label>
              <input
                type="email"
                class="form-control"
                formControlName="email"
                placeholder="Enter email"
                [disabled]="emailVerified"
              />
              <small class="text-danger"
                *ngIf="itemForm.get('email')?.touched && itemForm.get('email')?.invalid">
                Enter a valid email
              </small>
            </div>

            <!-- Verify Email Button -->
            <div>
              <button
                type="button"
                class="btn login-btn w-100"
                *ngIf="!showOtpSection"
                (click)="onVerifyEmail()
                "
                [disabled]="itemForm.get('email')?.invalid"
              >
                Verify Email
              </button>
            </div>

            <!-- OTP SECTION -->
            <div class="form-group mb-3" *ngIf="showOtpSection && !emailVerified">
              <div>
                <label>Enter OTP</label>
                <input
                  type="text"
                  class="form-control"
                  placeholder="Enter OTP"
                  formControlName="otp"
                  name="otp"
                />
              </div>
              <div>
                <small class="text-danger" *ngIf="otpError">{{ otpError }}</small>
                <div class="mt-2">
                  <button type="button" class="btn login-btn w-100" (click)="verifyOtp()">
                    Verify OTP
                  </button>
                </div>
              </div>
            </div>

            <p class="success-msg" *ngIf="emailVerified">
              ‚úÖ Email verified successfully
            </p>

            <!-- Password -->
            <div class="form-group mb-3">
              <label>Password</label>
              <input
                type="password"
                class="form-control"
                formControlName="password"
                placeholder="Enter password"
                (input)="checkPasswordStrength()"
                (focus)="showChecklist = true"
                (blur)="showChecklist = false"
              />
              <small class="fw-bold" [style.color]="strengthColors[passwordStrength]">
                {{ passwordStrength }}
              </small>

              <!-- ‚úÖ Live validation checklist (NEW) -->
              <div class="password-checklist" *ngIf="showChecklist && !allValid">
                <p [class.valid]="hasMinLength">
                  <span>{{ hasMinLength ? '‚úÖ' : '‚ùå' }}</span> Minimum 8 characters
                </p>
                <p [class.valid]="hasLowerCase">
                  <span>{{ hasLowerCase ? '‚úÖ' : '‚ùå' }}</span> At least one lowercase letter
                </p>
                <p [class.valid]="hasUpperCase">
                  <span>{{ hasUpperCase ? '‚úÖ' : '‚ùå' }}</span> At least one uppercase letter
                </p>
                <p [class.valid]="hasDigit">
                  <span>{{ hasDigit ? '‚úÖ' : '‚ùå' }}</span> At least one digit
                </p>
                <p [class.valid]="hasSpecialChar">
                  <span>{{ hasSpecialChar ? '‚úÖ' : '‚ùå' }}</span> At least one special character
                </p>
              </div>

              <!-- (kept) your existing guidance list -->
              <!-- <ul class="text-danger mt-1" *ngIf="passwordMessages.length">
                <li *ngFor="let msg of passwordMessages">
                  {{ msg }}
                </li>
              </ul> -->
            </div>

            <!-- Confirm Password -->
            <div class="form-group mb-3">
              <label>Confirm Password</label>
              <input
                type="password"
                class="form-control"
                [formControl]="confirmPasswordCtrl"
                placeholder="Confirm password"
                [ngClass]="{'ng-invalid ng-touched':confirmPasswordCtrl.dirty && confirmPasswordCtrl.value !== itemForm.get('password')?.value}"
              />
              <small class="text-danger"
                *ngIf="confirmPasswordCtrl.dirty && confirmPasswordCtrl.value !== itemForm.get('password')?.value">
                Passwords do not match
              </small>
              <small class="text-success fw-bold"
                *ngIf="confirmPasswordCtrl.dirty && confirmPasswordCtrl.value === itemForm.get('password')?.value">
                Password matched
              </small>
            </div>

            <!-- Role -->
            <div class="form-group mb-4">
              <label>Role</label>
              <select class="form-control" formControlName="role">
                <option value="" disabled>Choose role</option>
                <option value="HOSPITAL">Hospital</option>
                <option value="TECHNICIAN">Technician</option>
                <option value="SUPPLIER">Supplier</option>
              </select>
            </div>

            <button
              type="submit"
              class="btn login-btn w-100"
              (click)="onRegister()"
            >
              Register
            </button>

            <!-- Status messages -->
            <div *ngIf="showError" class="alert alert-danger mt-2">{{ responseMessage }}</div>
            <div *ngIf="showMessage" class="alert alert-success mt-2">{{ responseMessage }}</div>

            <p class="register-text mt-3">
              Already have an account?
              <a routerLink="/login">Login</a>
            </p>
          </form>

          <!-- ‚úÖ SUCCESS POPUP OVERLAY (Registration) -->
          <div class="success-overlay" *ngIf="showRegSuccess">
            <div class="success-card">
              <div class="success-badge">
                <svg class="checkmark" viewBox="0 0 52 52" aria-hidden="true">
                  <circle cx="26" cy="26" r="23"></circle>
                  <path d="M16 27 L22 33 L36 19"></path>
                </svg>
              </div>

              <h3 class="success-title">Registration Successful!</h3>
              <!-- Uses the same message you build in TS; falls back to generic if blank -->
              <p class="success-subtitle">
                {{ regSuccessMessage || responseMessage || 'Your account has been created successfully.' }}
              </p>

              <button type="button" class="btn success-primary" (click)="continueToLogin()">
                Continue to Login
              </button>
            </div>
          </div>

          <!-- ‚úÖ EMAIL VERIFICATION POPUP -->
          <div class="success-overlay" *ngIf="showEmailPopup">
            <div class="success-card">
              <div class="success-badge">
                <svg class="checkmark" viewBox="0 0 52 52">
                  <circle cx="26" cy="26" r="23"></circle>
                  <path d="M16 27 L22 33 L36 19"></path>
                </svg>
              </div>
              <h3 class="success-title">OTP Sent!</h3>
              <p class="success-subtitle">An OTP has been sent to your email address.</p>
              <button type="button" class="btn success-primary" (click)="closeEmailPopup()">OK</button>
            </div>
          </div>

          <!-- ‚úÖ OTP VERIFIED POPUP -->
          <div class="success-overlay" *ngIf="showOtpPopup">
            <div class="success-card">
              <div class="success-badge">
                <svg class="checkmark" viewBox="0 0 52 52">
                  <circle cx="26" cy="26" r="23"></circle>
                  <path d="M16 27 L22 33 L36 19"></path>
                </svg>
              </div>
              <h3 class="success-title">Email Verified!</h3>
              <p class="success-subtitle">Your email has been successfully verified.</p>
              <button type="button" class="btn success-primary" (click)="closeOtpPopup()">OK</button>
            </div>
          </div>

        </div>
      </div>

      <!-- RIGHT SIDE : ILLUSTRATION -->
      <div class="col-lg-6 d-none d-lg-flex p-0">
        <div class="illustration-section">
          <img
            src="assets/images/medical-login3.png"
            class="illustration-img"
            alt="Medical Illustration"
          />
        </div>
      </div>

    </div>
  </div>
</section>

